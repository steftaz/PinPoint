{% extends "datacaptureapp/base.html" %}

{% block content %}

    <h3 id="helpIcon" tabindex="0" class="pull-right" data-toggle="popover" style="margin-left:5px"
        data-placement="left" data-trigger=focus" aria-hidden=true" data-html="true"
        title="Data overview"
        data-content="<b> Data overview</b> <br>
        All the points you have collected so far are visible in the table below. Click 'Back to Map' to go back to the project where all the points are visible on a map.
        <br>
        <br>
        <b> Export Data </b> <br>
        Click the 'Export Data' button to export your data from this project. You can define the type of data by clicking the arrow down and choosing your data type.
            ">
        <span class="fa fa-question-circle" style="color:grey; margin-right:10px"></span>
    </h3>
    <h1 class="text-center display-4">Data overview</h1>
    <hr/>
    <div class="container">
        <div class="row justify-content-center">
            <button class="text-center btn btn-info btn-lg" onclick="location.href='../'" type="button" style="margin-right:10px"> Back to Map</button>
            <form method="POST" >
                {% csrf_token %}
                <div class="dropdown">
                    <button class=" btn btn-outline-danger btn-lg dropdown-toggle" data-toggle="dropdown" style="margin-right:5px">
                        Export Data</button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <div class="dropdown-header">Choose data type</div>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#" onclick="set_data_type('GeoJSON')">GeoJSON</a>
                        <a class="dropdown-item" href="#" onclick="set_data_type('CSV')">CSV</a>
                    </div>
                </div>
                <input class="form-control" type="hidden" id="data_type" name="data_type">
            </form>
        </div>
    </div>

    <script>
        function set_data_type(type) {
            let elem = document.getElementById("data_type");
            elem.value = type;
            elem.form.submit();
        }
    </script>

    <BR>
    <div class="row justify-content-center">
        <div class="col-auto">
            <table class="table table-responsive">
                <thead>
                <tr>
                    <th scope="col">latitude</th>
                    <th scope="col">longitude</th>
                    {% for attribute in attributes %}
                        <th scope="col"> {{ attribute.name }}</th>
                    {% endfor %}
                </tr>
                </thead>
                <tbody>
                {% for key, value in overview.items %}
                    <tr>
                        {% for data in value.values %}
                            <td>{{ data }}</td>
                        {% endfor %}
                        <td><a onclick="edit_node({{ key }})"><button class="btn btn-outline-secondary btn-sm" type="button">
                            Edit
                        </button></a></td>
                        <td><a onclick="remove_node({{ key }})"><button class="close" aria-label="Close" style="color: red; opacity: 1;" type="button">
                            <span aria-hidden="true">&times;</span>
                        </button></a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <form method="POST" >
        {% csrf_token %}
        <input class="form-control" type="hidden" id="edit_node" name="edit_node">
    </form>
    <form method="POST" >
        {% csrf_token %}
        <input class="form-control" type="hidden" id="remove_node" name="remove_node">
    </form>

    <script>
        function edit_node(id) {
            let elem = document.getElementById("edit_node");
            elem.value = id;
            elem.form.submit();
        }
        function remove_node(id) {
            let elem = document.getElementById("remove_node");
            elem.value = id;
            elem.form.submit();
        }
    </script>

{% endblock %}