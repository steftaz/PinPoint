{% extends "datacaptureapp/base.html" %}

{% block content %}
    <h3 id="helpIcon" tabindex="0" class="pull-right" data-toggle="popover" style="margin-left:5px"
        data-placement="left" data-trigger=focus" aria-hidden=true" data-html="true"
        title="Adding Data"
        data-content="<b> Add a data point</b> <br>
        Fill in the form you have defined by and click 'Store data point' to save this point. The location of this point will automatically be stored together with its features.
        <br>">
        <span class="fa fa-question-circle" style="color:grey; margin-right:10px"></span>
    </h3>
    <h1 class="text-center display-4">Add Data</h1>
    <hr/>
    <br>

    <div class="form-group">

        <div class="container center_div">
            <form method="POST" id="storeDataPoint">

                <div class="form-group">
                    {% csrf_token %}
                    {% for data in datas %}
                        <br />
                        <div class="container center_div">
                            <label for="name">{{ data.attribute.name }}</label>
                            <input type="{{ data.attribute.type }}" name="{{ data.attribute.name }}" class="form-control"
                                   placeholder="{{ data.attribute.name }}" id="{{ data.attribute.name }} required ">
                        </div>
                    {% endfor %}
                    <input class="form-control" type="hidden" id="latitude" name="latitude">
                    <input class="form-control" type="hidden" id="longitude" name="longitude">
                </div>
                <br>
                <button type="button" onclick="onSubmit()" class="btn btn-info">Store data point</button>
                <a href="../../"><button type="button" class="btn btn-outline-danger">Return to project</button></a>
            </form>

        </div>
    </div>

    <script>
        function onSubmit() {
            var iLat = document.getElementById('latitude');
            if (!iLat.value) {
                getLocation();
                return false;
            }
        }

        function recordPosition(position) {
            var iLat = document.getElementById('latitude');
            var iLong = document.getElementById('longitude');
            iLat.value = position.coords.latitude;
            iLong.value = position.coords.longitude;
            iLat.form.submit();
        }

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(getLocation_success, getLocation_error);
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        function getLocation_success(pos) {
            //showPosition(pos);
            recordPosition(pos);
        }

        function getLocation_error(err) {
            console.warn('ERROR(' + err.code + '): ' + err.message);
        }

    </script>

{% endblock %}