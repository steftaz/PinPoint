{% extends "datacaptureapp/base.html" %}

{% block content %}
  <BR>
    <h1 class="text-center">Add Data</h1>
	<BR>

  <form id="storeDataPoint">
  <div class="form-group">

      <div class="container center_div">
           <div class="form-group">
               {% csrf_token %}
               {% for attribute in attributes %}
                   <label for="{{ attribute.name }}">{{ attribute.name }}</label>
                   <input  class="form-control" id="{{ attribute.name }}" type="{{ attribute.type }}">
               {% endfor %}
           </div>

<BR>

  </div>
  </div>
</form>

              <button onclick="getPosition()" class="btn btn-primary">Store data point</button>

    <script>
    var latitude;
    var longitude;

    function getPosition() {
        navigator.geolocation.getCurrentPosition(postCoordinates);
    }


    function postCoordinates(position) {
        if (navigator.geolocation) {
            latitude = position.coords.latitude;
            longitude = position.coords.longitude;
        } else {
            alert("Geolocation is not supported by this browser.");
            return
    }
        $.ajax({
            type: "POST",
            url: "http://127.0.0.1:8000/projects/"+({{ project_id }})+"/nodes/new/",
            dataType: "json",
            async: true,
            data: {
                csrfmiddlewaretoken: '{{ csrf_token }}',
                latitude: latitude,
                longitude: longitude
            },
            success: function (json) {
                $('#output').html(json.message);
            }
        });
    }
    </script>

{% endblock %}